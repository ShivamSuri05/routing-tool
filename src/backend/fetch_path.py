from functions.route_prediction import get_all_routes
from functions.utils import convert_to_float
from functions.save_retrieve_graph import use_saved_graph_sample


def fetch_paths(src, dst, height, buffer_height, num_paths):
    src = src.split(" ")
    start_point = (convert_to_float(src[0]), convert_to_float(src[1]))
    dst = dst.split(" ")
    end_point = (convert_to_float(dst[0]), convert_to_float(dst[1]))
    buffer_height = convert_to_float(buffer_height)
    height = convert_to_float(height)
    num_paths = int(num_paths)
    print(start_point, end_point, height, buffer_height)
    valid_filepath = "data/autobahns_germany_with_restrictions.graphml"
    loaded_graph = use_saved_graph_sample(valid_filepath)
    try:
        paths = get_all_routes(loaded_graph, start_point, end_point, num_paths , buffer_height+height)
        #paths = [[93014209, 1594531855, 491164, 491179, 491180, 491213, 94170412, 491220, 5789574746, 510617, 94170191, 94170196, 491788, 94074641, 326893039, 94074560, 1384522839, 1659223892, 95966208, 11981282, 95966399, 253043428, 253043456, 253043400, 21573263, 30845029, 280763543, 249245581, 21424998, 21424650, 268273247, 2887358771, 21424636], [93014209, 1594531855, 491164, 491179, 491180, 491213, 94170412, 491220, 5789574746, 510617, 94170191, 94170196, 491788, 94074641, 326893039, 94074560, 1384522839, 1659223892, 95966208, 11981282, 11981293, 95966399, 253043428, 253043456, 253043400, 21573263, 30845029, 280763543, 249245581, 21424998, 21424650, 268273247, 2887358771, 21424636], [93014209, 1594531855, 491164, 491179, 491180, 491213, 94170412, 491220, 5789574746, 510617, 94170191, 94170196, 491788, 94074641, 326893039, 94074560, 1384522839, 1659223892, 95966208, 11981282, 95966399, 253043428, 253043438, 253043456, 253043400, 21573263, 30845029, 280763543, 249245581, 21424998, 21424650, 268273247, 2887358771, 21424636], [93014209, 1594531855, 491164, 491179, 491180, 491213, 94170412, 491220, 5789574746, 510617, 94170191, 94170196, 491788, 94074641, 326893039, 94074560, 1384522839, 1659223892, 95966208, 11981282, 95966399, 253043428, 253043456, 253043400, 21573261, 21573263, 30845029, 280763543, 249245581, 21424998, 21424650, 268273247, 2887358771, 21424636], [93014209, 1594531855, 491164, 491179, 491180, 491213, 94170412, 491220, 5789574746, 510617, 94170191, 94170196, 491788, 94074641, 326893039, 94074560, 1384522839, 1659223892, 95966208, 11981282, 95966399, 253043428, 253043456, 253043400, 21573263, 30845029, 280763543, 249245581, 21424998, 21424650, 268273247, 110057419, 2887358771, 21424636]]
        print(paths)
        formatted_response = []
        for path in paths:
            path_list = []
            for node in path:
                coord = (loaded_graph.nodes[node]['y'], loaded_graph.nodes[node]['x'])
                path_list.append([node, coord])
            formatted_response.append(path_list)
        
        return (formatted_response)
    except (ValueError, TypeError):
        return "No Paths Found"
